<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ladaza Agent ç®¡ç†é¡µ</title>
<style>
  body{font-family:system-ui,Segoe UI,Arial;margin:0;background:#fafafa;color:#222;padding:24px;max-width:760px}
  .card{background:#fff;border:1px solid #eee;border-radius:12px;padding:16px;box-shadow:0 4px 12px rgba(0,0,0,.05)}
  button{background:#b58b6b;color:#fff;border:0;border-radius:10px;padding:10px 16px;cursor:pointer}
  pre{background:#0b1020;color:#cfe2ff;padding:12px;border-radius:8px;overflow:auto}
  a{color:#0b5ed7}
</style>
<h1>ğŸ§  Ladaza Agent ç®¡ç†é¡µï¼ˆä¸Šä¼  CSVï¼‰</h1>
<div class="card">
  <p>é€‰æ‹© CSVï¼ˆè¡¨å¤´å¿…é¡»æ˜¯ï¼š<code>åç§°,å°ºå¯¸,æè´¨,ç‰¹ç‚¹,å¤‡æ³¨</code>ï¼‰â†’ ç‚¹å‡»ä¸Šä¼ </p>
  <input id="file" type="file" accept=".csv" />
  <button id="go">å¼€å§‹ä¸Šä¼ </button>
  <p id="status"></p>
  <pre id="log"></pre>
  <p><a href="/">è¿”å›é¦–é¡µ</a></p>
</div>
<script>
  const log=t=>document.getElementById('log').textContent+=t+"\\n";
  document.getElementById('go').onclick=async ()=>{
    const f=document.getElementById('file').files[0]; if(!f){alert('è¯·é€‰æ‹© CSV');return;}
    const text=await f.text(); const rows=text.split(/\\r?\\n/).filter(x=>x.trim().length);
    const header=rows.shift().split(','); const idx=k=>header.findIndex(h=>h.trim()===k);
    const iN=idx('åç§°'),iS=idx('å°ºå¯¸'),iM=idx('æè´¨'),iF=idx('ç‰¹ç‚¹'),iR=idx('å¤‡æ³¨');
    if([iN,iS,iM,iF,iR].some(i=>i<0)){document.getElementById('status').textContent='âŒ CSV è¡¨å¤´ä¸æ­£ç¡®';return;}
    const items=[]; for(const r of rows){const c=r.split(','); const t=`${c[iN]||''} | å°ºå¯¸:${c[iS]||''} | æè´¨:${c[iM]||''} | ç‰¹ç‚¹:${c[iF]||''} | å¤‡æ³¨:${c[iR]||''}`.trim(); if(t && t!=='| å°ºå¯¸: | æè´¨: | ç‰¹ç‚¹: | å¤‡æ³¨:') items.push(t);}
    document.getElementById('status').textContent='ğŸš€ ä¸Šä¼ ä¸­â€¦'; log(`ğŸ“¦ ${items.length} æ¡`);
    try{const res=await fetch('/ingest',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({items})}); const data=await res.json(); document.getElementById('status').textContent='âœ… å®Œæˆ'; log(JSON.stringify(data,null,2));}
    catch(e){document.getElementById('status').textContent='âŒ å¤±è´¥'; log(String(e));}
  };
</script>
